<!DOCTYPE html>
<html lang="en">
  <head>
    <title>DACSDKMA  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="DACSDKMA  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">DACSDKMA Docs</a> (100% documented)</p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">DACSDKMA Reference</a>
        <img id="carat" src="img/carat.png" />
        DACSDKMA  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/DACSDKMAAVPlayerContentPlayhead.html">DACSDKMAAVPlayerContentPlayhead</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DACSDKMAAdContainer.html">DACSDKMAAdContainer</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DACSDKMAAdError.html">DACSDKMAAdError</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DACSDKMAAdEvent.html">DACSDKMAAdEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DACSDKMAAdVideoPlayableStates.html">DACSDKMAAdVideoPlayableStates</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DACSDKMAAdsLoadedData.html">DACSDKMAAdsLoadedData</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DACSDKMAAdsLoader.html">DACSDKMAAdsLoader</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DACSDKMAAdsManager.html">DACSDKMAAdsManager</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DACSDKMAAdsRequest.html">DACSDKMAAdsRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DACSDKMACompanionSlot.html">DACSDKMACompanionSlot</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DACSDKMASettings.html">DACSDKMASettings</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/DACSDKMAAdErrorCode.html">DACSDKMAAdErrorCode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DACSDKMAAdErrorType.html">DACSDKMAAdErrorType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DACSDKMAAdEventType.html">DACSDKMAAdEventType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DACSDKMAAdVideoPlaybackStates.html">DACSDKMAAdVideoPlaybackStates</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DACSDKMAAdViewMode.html">DACSDKMAAdViewMode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DACSDKMAInViewStates.html">DACSDKMAInViewStates</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/DACSDKMAAdsLoaderDelegate.html">DACSDKMAAdsLoaderDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DACSDKMAAdsManagerDelegate.html">DACSDKMAAdsManagerDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DACSDKMAContentPlayhead.html">DACSDKMAContentPlayhead</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <a href='#dac-multimedia-ads-sdk-dacsdkma-ios' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='dac-multimedia-ads-sdk-dacsdkma-ios'>DAC Multimedia Ads SDK (DACSDKMA) - iOS</h1>

<hr>
<a href='#' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id=''>準備するもの</h2>

<ul>
<li>Xcode : 8.3.0</li>
<li>iOS   : 8.0+</li>
<li>DACSDKMA (iOS)</li>
</ul>

<hr>
<a href='#swift' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='swift'>導入手順 (Swift)</h2>

<p>今回の手順では、プリロールかつ自動再生の広告を再生することが可能になります。</p>
<a href='#step-1-xcode' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='step-1-xcode'>Step 1. Xcodeプロジェクトにフレームワークを追加します</h3>

<ol>
<li><q>DACSDKMA.zip</q>を展開し、以下のいずれかを任意のフォルダに配置します。

<ul>
<li><q>universal</q>: iOS実機用とシミュレーター用のバイナリを含むフレームワークです。デバッグなどの際は、こちらを利用すると便利です。<br>
iTunesConnectへアップロードする際に、以下のエラーが出る際は<q>device</q>版のフレームワークをご利用ください。<br>

<ul>
<li>ERROR ITMS-90087: <q>Unsupported Architecture. Your executable contains unsupported architecture &lsquo;[x86_64, i386]&rsquo;.</q></li>
</ul></li>
<li><q>device</q>: iOS実機用のみのバイナリを含むフレームワークです。シミュレーターでの利用はできません。</li>
</ul></li>
<li>Xcodeからプロジェクトを開きます。<br></li>
<li>[Framework Serch Paths] を設定します。

<ol>
<li><q>プロジェクトナビゲータ</q>からプロジェクトを選択し、<q>プロジェクトエディタ</q>から[PROJET か 該当するTARGETS]を選択します。</li>
<li>[Build Settings]-&gt;[Serch Paths]-&gt;[Framework Serch Paths]に、<q>DACSDKMA.framework</q>の親フォルダ(手順 1.で配置したパス)を指定し、追加します。

<ul>
<li>例) ~/DACSDKMA/universal</li>
</ul></li>
</ol></li>
<li>[Embedded Binaries] 、および [Linked Frameworks and Libraries] を設定します。

<ol>
<li><q>プロジェクトエディタ</q>から[該当するTARGETS]を選択します。</li>
<li>[General]-&gt;[Embedded Binaries]セクションを選択し、左下の <q>+</q>をクリックします。<br></li>
<li><q>Add Other&hellip;</q>をクリックし、<q>DACSDKMA.framework</q>を選択し、<q>Open</q>をクリックします。<br></li>
<li><q>Choose options for adding these files</q>画面での<q>Added folders</q>の項目は<q>Create groups</q>を選択し、<q>Finish</q> をクリックします。<br></li>
<li>[General]-&gt;[Embedded Binaries]にDACSDKMA.frameworkが追加されます。<br>
[General]-&gt;[Linked Frameworks and Libraries]にDACSDKMA.frameworkが追加されます。</li>
</ol></li>
</ol>
<a href='#step-2-xcode' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='step-2-xcode'>Step 2. Xcodeプロジェクトにソースコードを追加します</h3>

<ol>
<li>DACSDKMA/src内にある、以下のファイルをプロジェクトに追加します。

<ul>
<li>DACSDKMAAdController.swift</li>
<li>DACSDKMAAdControlsView.swift</li>
<li>DACSDKMAAdImageGenerator.swift</li>
<li>DACSDKMASmartVisionAdPlayer.swift</li>
<li>DACSDKMAUtils.swift</li>
</ul></li>
</ol>
<a href='#step-3-framework' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='step-3-framework'>Step 3. frameworkをインポートします</h3>

<ol>
<li><p>広告を表示する<q>ViewController</q>に以下の記述を加えます。  </p>
<pre class="highlight plaintext"><code>import DACSDKMA
</code></pre></li>
</ol>
<a href='#step-4' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='step-4'>Step 4. 広告をリクエストします</h3>

<p>フレームワークに同梱されてる、<q>DACSDKMASmartVisionAdPlayer</q>クラスを利用することで、以下の複雑な手順を飛ばすことも可能です。必要に応じて、後述を確認ください。</p>

<ol>
<li><p><q>ViewController</q>に次のプロパティを追加します。  </p>
<pre class="highlight plaintext"><code>let adTagUri = "https://..."
var dacsdkmaAdsLoader: DACSDKMAAdsLoader?  = nil
var dacsdkmaAdsManager: DACSDKMAAdsManager? = nil
var dacsdkmaAdController: DACSDKMAAdController? = nil
</code></pre></li>
<li><p>適当なタイミングで広告をリクエストします。  </p>
<pre class="highlight plaintext"><code>let settings = DACSDKMASettings()
self.dacsdkmaAdsLoader = DACSDKMAAdsLoader(settings: settings)
self.dacsdkmaAdsLoader?.delegate = self

// 広告動画を掲載するViewと、リクエスト先アドサーバのURIをリクエストにセットします。
let adContainer = DACSDKMAAdContainer(view: self.videoView)
let request = DACSDKMAAdsRequest(adTagURI: self.adTagUri, adContainer: adContainer)
self.dacsdkmaAdsLoader?.requestAds(request)
</code></pre></li>
</ol>
<a href='#step-5-delegate' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='step-5-delegate'>Step 5. delegateを継承します</h3>

<ol>
<li><p><q>ViewController</q>に以下の2つの<q>delegate protocol</q>を継承し、<q>delegateメソッド</q>を追加します。  </p>
<pre class="highlight plaintext"><code>class ViewController: UIViewController, DACSDKMAAdsLoaderDelegate,  DACSDKMAAdsManagerDelegate {

    /// VASTレスポンスの処理が終わった時に実行されます。
    func dacSdkMaAdsLoader(loader: DACSDKMAAdsLoader, didLoad adsLoadedData: DACSDKMAAdsLoadedData) {
        self.dacsdkmaAdsManager = adsLoadedData.adsManager
        self.dacsdkmaAdsManager?.delegate = self
        // 広告動画ファイルのダウンロードします。
        self.dacsdkmaAdsManager?.load()

        // 広告動画操作インスタンスを生成します。
        self.dacsdkmaAdController = DACSDKMAAdController(adsManager: adsLoadedData.adsManager)
    }

    /// VASTリクエスト/レスポンスでエラーが呼ばれたときに実行されます。
    func dacSdkMaAdsLoader(loader: DACSDKMAAdsLoader, didFail adError: DACSDKMAAdError) {
        // エラーログを出力する。
        print("dacSdkMaAdsLoader: didFail: \(adError.message)")
    }

    /// AdsManagerのイベントが発生した時に実行されます。
    func dacSdkAdsManager(adsManager: DACSDKMAAdsManager, didReceiveAdEvent adEvent: DACSDKMAAdEvent) {
        if (adEvent.type == DACSDKMAAdEventType.DidAllAdsComplete) {
            // 広告動画が終了したら、広告を消去します。
            self.dacsdkmaAdsManager?.clean()
            self.dacsdkmaAdsManager = nil
            self.dacsdkmaAdController?.clean()
            self.dacsdkmaAdController = nil
        }
    }

    /// AdsManagerにエラーが発生した時に実行されます。
    func dacSdkAdsManager(adsManager: DACSDKMAAdsManager, didReceiveAdError adError: DACSDKMAAdError) {
        print("dacSdkMaAdsManager: didReceiveAdError: \(adError.message)")
    }

    /// 動画広告が再生開始した際に実行されます。
    func dacSdkAdsManagerDidRequestContentPause(adsManager: DACSDKMAAdsManager) {
        // 本編動画を一時停止
        self.contentPlayer.pause()
    }

    /// 動画広告が正常終了・エラー終了した際に実行されます。
    func dacSdkAdsManagerDidRequestContentResume(adsManager: DACSDKMAAdsManager) {
        // 本編動画を再生再開
        self.contentPlayer.play()
    }
}
</code></pre></li>
</ol>
<pre class="highlight plaintext"><code>* 詳しいコードは、zip内のDACSDKMA-SamplePlayer-Swiftを参照してください。
</code></pre>
<a href='#step-6' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='step-6'>Step 6. 動作確認をします</h3>

<p>正しく広告が表示されることを確認して下さい。</p>

<hr>
<a href='#objective-c' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='objective-c'>導入手順 (Objective-C)</h2>
<a href='#step-1-step-5' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='step-1-step-5'>Step 1. 〜 Step 5.</h3>

<ol>
<li>導入手順(Swift) - Step 1. 〜 Step 5. と同様の手順です。<br>

<ul>
<li>詳細については、サンプルをご確認ください。</li>
</ul></li>
</ol>
<a href='#step-6-objective-c-swift-framework' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='step-6-objective-c-swift-framework'>Step 6. Objective-CでSwiftのframeworkをインポートするための設定をします</h3>

<ol>
<li><q>プロジェクトナビゲータ</q>からプロジェクトを選択し、<q>プロジェクトエディタ</q>から[PROJET か 該当するTARGETS]を選択します。</li>
<li>[Build Settings]を選択して、以下の設定を確認します。

<ol>
<li>[Swift Compiler - Version] -&gt; [Swift Language Version]が<q>Swift 3</q>であることを確認します。そうでない場合、<q>Swift 3</q>に変更します。</li>
</ol></li>
</ol>
<a href='#step-7-swift-generated-header' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='step-7-swift-generated-header'>Step 7. Swift Generated Headerをインポートします</h3>

<ol>
<li><q>プロジェクトナビゲータ</q>からプロジェクトを選択し、<q>プロジェクトエディタ</q>から[PROJET か 該当するTARGETS]を選択します。</li>
<li>[Build Settings] -&gt; [Swift Compiler - General] -&gt; [Objective-C Generated Interface Header Name]を確認します。<br>

<ul>
<li>デフォルトでは、<q>プロジェクト名-Swift.h</q>になります。</li>
<li>無い場合は、ヘッダーファイルを新規作成し、プロジェクトに追加してください。<br></li>
<li>参考: <a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/BuildingCocoaApps/MixandMatch.html">Using Swift with Cocoa and Objective-C (Swift 3.0.1)</a></li>
</ul></li>
<li><p>広告を表示する<q>ViewController.m</q>に上記で確認したヘッダーをインポートします。  </p>
<pre class="highlight plaintext"><code>#import "プロジェクト名-Swift.h"
</code></pre></li>
</ol>
<a href='#step-8' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='step-8'>Step 8. 動作確認をします</h3>

<p>正しく広告が表示されることを確認して下さい.</p>

<hr>
<a href='#q-dacsdkmasmartvisionadplayer-q' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='q-dacsdkmasmartvisionadplayer-q'><q>DACSDKMASmartVisionAdPlayer</q>クラスを使用する</h2>

<ol>
<li><p>フレームワークに同梱されている、<q>DACSDKMASmartVisionAdPlayer</q>クラスを利用することで、以下のような記述で簡単に動画広告を再生することが可能です。利用する際は<q>src</q>フォルダ内のsrcを全てターゲットに追加してください。</p>
<pre class="highlight plaintext"><code>class ViewController: UIViewController {
    override func viewDidLoad() {
        super.viewDidLoad()

        let smartVisionAdPlayer = DACSDKMASmartVisionAdPlayer(frame: CGRectMake(20, 20, 320, 250))
        smartVisionAdPlayer.load("https://....")        
        self.videoView.addSubview(smartVisionAdPlayer)
    }
}
</code></pre></li>
</ol>

<hr>
<a href='#' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id=''>こんな時は？</h2>

<ul>
<li>Q. ビルド時に<q>&lsquo;No such module 'DACSDKMA&rsquo;</q>とエラーログに表示される場合<br>
A. [Framework Serch Paths]の設定がされていないか、誤っております。正しいパスを設定ください。<br>
<q>Step 1-3</q>を参考にしてください。</li>
<li>Q. ビルド時に<q>&lsquo;xxxxx&rsquo; is unavailable: cannot find Swift declaration for this class.</q>とエラーログに表示される場合<br>
A. シミュレーター用のビルドでは、<q>device版</q>のフレームワークはご利用できません。<br>
[Framework Serch Paths]を<q>universal</q>版のフレームワークに切り替えてください。<br>
<q>Step 1-3</q>を参考にしてください。</li>
<li>Q. アプリを起動するとクラッシュし、以下のようなエラーがコンソールに表示される場合<br>
<q>dyld: Library not loaded: @rpath/DACSDKMA.framework/DACSDKMA  
Referenced from: ~/Library/Developer/CoreSimulator/Devices/xxxx/data/Containers/Bundle/Application/xxxx/xxxx.app/xxxx  
Reason: image not found</q><br>
A. [Embedded Binaries]を設定してください。<br>
<q>Step 1-4</q>を参考にしてください。</li>
<li><p>Q. <q>universal</q>フレームワークを使用したアプリをiTunesConnectにアップロードしたい場合<br>
A. ビルド時に<q>lipo -extract</q>コマンドなどで不要なバイナリを除外します。<br>
具体的にはターゲットの[Build Phases]で画面上部の<q>+</q>をクリックし、<q>New Run Script Phase</q>で作成されたPhase内に、以下のようなスクリプトを追加して対応してください。<br>
参考: <a href="http://ikennd.ac/blog/2015/02/stripping-unwanted-architectures-from-dynamic-libraries-in-xcode/">Stripping Unwanted Architectures From Dynamic Libraries In Xcode</a></p>
<pre class="highlight plaintext"><code>APP_PATH="${TARGET_BUILD_DIR}/${WRAPPER_NAME}"

find "$APP_PATH" -name '*.framework' -type d | while read -r FRAMEWORK
do
    FRAMEWORK_EXECUTABLE_NAME=$(defaults read "$FRAMEWORK/Info.plist" CFBundleExecutable)
    FRAMEWORK_EXECUTABLE_PATH="$FRAMEWORK/$FRAMEWORK_EXECUTABLE_NAME"
    echo "Executable is $FRAMEWORK_EXECUTABLE_PATH"

    EXTRACTED_ARCHS=()

    for ARCH in $ARCHS
    do
        echo "Extracting $ARCH from $FRAMEWORK_EXECUTABLE_NAME"
        lipo -extract "$ARCH" "$FRAMEWORK_EXECUTABLE_PATH" -o "$FRAMEWORK_EXECUTABLE_PATH-$ARCH"
        EXTRACTED_ARCHS+=("$FRAMEWORK_EXECUTABLE_PATH-$ARCH")
    done

    echo "Merging extracted architectures: ${ARCHS}"
    lipo -o "$FRAMEWORK_EXECUTABLE_PATH-merged" -create "${EXTRACTED_ARCHS[@]}"
    rm "${EXTRACTED_ARCHS[@]}"

    echo "Replacing original executable with thinned version"
    rm "$FRAMEWORK_EXECUTABLE_PATH"
    mv "$FRAMEWORK_EXECUTABLE_PATH-merged" "$FRAMEWORK_EXECUTABLE_PATH"
done
</code></pre></li>
</ul>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2017 <a class="link" href="https://www.dac.co.jp/" target="_blank" rel="external">D.A.Consortium Inc.</a>. All rights reserved. (Last updated: 2017-04-05)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.7.5</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
